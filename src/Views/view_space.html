<!DOCTYPE html>
<html lang="en">
<?php include_once __DIR__."/html_head.html" ?>
<body class="bg-gray-100">
    <?php include_once __DIR__ ."/navbar.html"?>
    
    <main class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold mb-6"><?= htmlspecialchars($space['name']) ?></h1>
        
        <div class="mb-8">
            <h2 class="text-2xl font-bold mb-4">Space Tweets</h2>
            <form id="space-tweet-form" class="mb-4">
                <textarea name="content" class="w-full p-2 border rounded" placeholder="What's happening in this space?"></textarea>
                <input type="hidden" name="space_id" value="<?= $space['id'] ?>">
                <button type="submit" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded">Post Tweet</button>
            </form>
            <div id="space-tweets">
                <?php foreach ($tweets as $tweet): ?>
                    <div class="bg-white p-4 rounded shadow mb-4">
                        <div class="flex items-center mb-2">
                            <img src="<?= htmlspecialchars($tweet['profile_picture']) ?>" alt="Profile" class="w-10 h-10 rounded-full mr-2">
                            <span class="font-bold"><?= htmlspecialchars($tweet['username']) ?></span>
                        </div>
                        <p><?= htmlspecialchars($tweet['content']) ?></p>
                        <span class="text-sm text-gray-500"><?= \Sora\Helpers\Helper::time_ago($tweet['created_at']) ?></span>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>
    </main>

    <script>
        document.getElementById('space-tweet-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);

            try {
                const response = await fetch('/spaces/tweet', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        // Refresh the tweets or add the new tweet to the list
                        location.reload();
                    } else {
                        alert('Failed to post tweet: ' + result.message);
                    }
                } else {
                    alert('Failed to post tweet. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An error occurred. Please try again.');
            }
        });
    </script>
</body>
</html>